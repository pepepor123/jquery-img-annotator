<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI (Draggable Widget)</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js"></script>
  <script>
  $(function() {

    const canvasWidth = 300;
    const canvasHeight = 300;

    $('#canvas').attr('width', canvasWidth);
    $('#canvas').attr('height', canvasHeight);
    const ctx = $("#canvas")[0].getContext('2d');

    const numHandles = 8;
    const handleRadius = 0.03;
    const handlePositions = [
      {x: 0.50, y: 0.50},
      {x: 0.30, y: 0.60},
      {x: 0.30, y: 0.75},
      {x: 0.35, y: 0.85},
      {x: 0.50, y: 0.90},
      {x: 0.65, y: 0.85},
      {x: 0.70, y: 0.75},
      {x: 0.70, y: 0.60}
    ];

    for (let i = 0; i < numHandles; i++) {
      const left = canvasWidth * (handlePositions[i].x - handleRadius);
      const top = canvasHeight * (handlePositions[i].y - handleRadius);
      $("#draggable-point" + i).css({left: left, top: top});

      $("#draggable-point" + i).draggable({
        containment: 'parent',
        scroll: false
      });

      $("#draggable-point" + i).on("drag", (event, ui) => {
        const point = $("#draggable-point" + i);
        handlePositions[i].x = (point.position().left + point.outerWidth() / 2) / canvasWidth;
        handlePositions[i].y = (point.position().top + point.outerHeight() / 2) / canvasHeight;
        drawAnnotation();
      });
    }

    const drawAnnotation = () => {
      ctx.clearRect(0, 0, canvasWidth, canvasHeight);

      ctx.beginPath();
      ctx.moveTo(handlePositions[0].x * canvasWidth, handlePositions[0].y * canvasHeight);
      for (let i = 1; i < numHandles; i++) {
        ctx.lineTo(handlePositions[i].x * canvasWidth, handlePositions[i].y * canvasHeight);
      }
      ctx.closePath();
      ctx.fillStyle = "rgba(0, 0, 255, 0.2)";
      ctx.fill();
      ctx.strokeStyle = "rgb(0, 0, 255)";
      ctx.stroke();

      for (let i = 0; i < numHandles; i++) {
        const cx = handlePositions[i].x * canvasWidth;
        const cy = handlePositions[i].y * canvasHeight;
        const radius = handleRadius * canvasWidth;

        ctx.beginPath();
        ctx.arc(cx, cy, radius, 0, 2 * Math.PI, false);
        ctx.fillStyle = "rgb(255, 255, 255)";
        ctx.fill();
        ctx.strokeStyle = "rgb(0, 0, 0)";
        ctx.stroke();
      }
    }

    drawAnnotation();

  });
  </script>
</head>
<body>

<div id="wrapper">

  <header>jQuery UI sample</header>

  <div id="container">
    <img id="face-image" src="./abe.png">
    <div class="draggable" id="draggable-point0"></div>
    <div class="draggable" id="draggable-point1"></div>
    <div class="draggable" id="draggable-point2"></div>
    <div class="draggable" id="draggable-point3"></div>
    <div class="draggable" id="draggable-point4"></div>
    <div class="draggable" id="draggable-point5"></div>
    <div class="draggable" id="draggable-point6"></div>
    <div class="draggable" id="draggable-point7"></div>
    <canvas id="canvas"></canvas>
  </div>

</div>

</body>
</html>
